---
title: SLAM流程
tags: slam
edit: 2017-02-02
categories: 技术类
status: Paused
mathjax: true
highlight: true
mermaid: true
description: 主要是针对ORB-SLAM2的流程进行理解
---
Local mapping的目的是什么？
当机器在初始化定位以后，它需要不断实时告诉自己所处的新位置。可是随着运动机器跟踪到的已知特征会越来越少，尤其是运动剧烈和有遮挡的时候。此外机器还会因为某些地方特征相似而跟踪错误。那么就机器需要实时构建新的环境特征并且建立错误跟踪监测机制，提高自己的定位准确度，这就是local mapping。

怎么剔除掉错误的跟踪特征点？
由于机器在运动，靠每帧新建立出来的特征点信息准确度不够高，大部分是和之前检测到的特征重复，因此需要一个强有力的匹配算法，比如BOW词袋模型匹配算法。
再者，可以利用双目或多目视角估计特征的空间位置，由于像素在图像中的位置非连续，它的位置精度取整，这会导致越远的特征点的位置精确度越低，这会不利于新地图的构建，进而影响机器定位。因此针对远点，我们往往要利用多帧视差计算来减少特征位置误差。可是这样并不能保证所有的特征位置准确，在后续的过程中，我们可以用极线限制，反投影，尺度一致等反复测试这些特征点是不是足够准确。
最后我们还要求某个特征点相关联的关键帧个数至少大于3（经验值），并且可以根据之前的相机姿态来估计哪些帧可以看到这个新的特征点，我们往往要求至少过去的帧里至少有四分之一可以检测到这个特征点。

用经过剔除以后的特征点怎么进行相机估计？
我们应该持有一个原则，就是尽可能多的利用匹配点来提高机器姿态估计准确度。一个办法就是将过滤一轮后的新特征点所涉及到的关键帧特征充分利用起来一起优化，没有匹配到的新特征点继续保持固定。值得注意的是有一个技巧处理，远处的特征点在估计旋转时权重更大，近处的特征点在估计平移和尺度的时候权重更大。

为什么Local mapping带来什么副作用可以靠Local BA解决？
随着时间的推移，不断增加的特征点和关键帧会增加系统复杂度，优化的速度也放慢下来。我们可以通过筛选冗余的关键帧来缓解内存压力。如果仔细观察，我们会发现很多关键帧的信息是重复的，经验上几乎九成的点可以通过其他3个关键帧看到。因此我们要尽可能提高关键帧之间的视差，来保证每个关键帧携带足够的特征信息又不重复。

此外，我们可以选择局部优化来代替前期的全局优化，Local BA 这个时候就起到作用了。我们把局部优化的频率增加，全局优化的频率下降，分成两个线程来保证定位的实时性。

还有一个技巧就是当某个时刻机器进入一个纹理相对多的环境，它检测到的新特征点足够多，这时候我们甚至可以暂时关掉建图功能不再检测新的特征点，只做定位运算。